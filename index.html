<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ¢—ç•Œç·šå¤§é—–é—œï¼ˆå€‹äººé—–é—œç‰ˆï¼‰</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --line:#243059;
      --text:#eef3ff; --muted:#b9c4e6;
      --g:#22c55e; --y:#facc15; --r:#ef4444; --b:#2a5bff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Arial,"Noto Sans TC",sans-serif;background:radial-gradient(1200px 800px at 20% -10%, #1a2b6a 0%, var(--bg) 55%);color:var(--text);}
    .wrap{max-width:1020px;margin:0 auto;padding:18px;}
    .card{background:rgba(18,26,51,.92);border:1px solid var(--line);border-radius:18px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);}
    h1{margin:0;font-size:22px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .space{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    input, textarea{
      width:100%;border:1px solid var(--line);background:#0f1734;color:var(--text);
      border-radius:14px;padding:12px;font-size:15px;outline:none;
    }
    textarea{min-height:72px;resize:vertical}
    button{
      border:1px solid var(--line);background:#0f1734;color:var(--text);
      padding:12px 14px;border-radius:14px;cursor:pointer;font-weight:1000;
      transition:transform .06s ease, filter .15s ease;
    }
    button:active{transform:scale(.98)}
    button:hover{filter:brightness(1.08)}
    .primary{background:var(--b);border-color:var(--b)}
    .g{border-color:rgba(34,197,94,.5)} .y{border-color:rgba(250,204,21,.5)} .r{border-color:rgba(239,68,68,.5)}
    .g:hover{background:rgba(34,197,94,.14)} .y:hover{background:rgba(250,204,21,.14)} .r:hover{background:rgba(239,68,68,.14)}
    .bigQ{font-size:34px;line-height:1.22;font-weight:1100;margin:10px 0 6px}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);padding:8px 10px;border-radius:999px;color:var(--muted);font-size:13px}
    .bar{height:10px;background:#0e1531;border:1px solid var(--line);border-radius:999px;overflow:hidden}
    .fill{height:100%;width:0%;background:linear-gradient(90deg,var(--g),var(--y),var(--r))}
    .grid2{display:grid;grid-template-columns:1.1fr .9fr;gap:12px;margin-top:12px}
    @media (max-width:920px){.grid2{grid-template-columns:1fr}}
    .tag{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:1100;border:1px solid transparent}
    .tG{background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.35)}
    .tY{background:rgba(250,204,21,.18);border-color:rgba(250,204,21,.35)}
    .tR{background:rgba(239,68,68,.18);border-color:rgba(239,68,68,.35)}
    .shake{animation:shake .25s ease-in-out 0s 2}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}
    .pop{animation:pop .18s ease-out}
    @keyframes pop{0%{transform:scale(.98)}100%{transform:scale(1)}}
    .mini{font-size:12px;line-height:1.5;color:var(--muted)}
    .hide{display:none}
    .stat{border:1px solid var(--line);border-radius:16px;padding:12px;background:#0f1734}
    .stat b{font-size:18px}
    .map{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .node{
      border:1px solid var(--line);border-radius:999px;padding:8px 10px;
      background:#0f1734;color:var(--muted);font-size:12px;font-weight:1000
    }
    .node.on{border-color:#3b82f6;color:#dbe7ff;background:rgba(59,130,246,.14)}
    .node.done{border-color:rgba(34,197,94,.45);color:#b6f7cc;background:rgba(34,197,94,.12)}
    .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);padding:7px 10px;border-radius:999px;background:#0f1734;color:var(--text);font-size:12px;font-weight:1000}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="space" style="margin-bottom:12px">
      <h1>ğŸ® æ¢—ç•Œç·šå¤§é—–é—œï¼ˆå€‹äººé—–é—œç‰ˆï¼‰</h1>
      <div class="pill">ğŸŸ¢å®‰å…¨ï½œğŸŸ¡æœ‰é¢¨éšªï½œğŸ”´è¸©ç·šã€€â±ï¸æ¯é¡Œ 6 ç§’ã€€â¤ï¸å¤±èª¤ 3 æ¬¡ Game Over</div>
    </div>

    <!-- Start -->
    <div id="screenStart" class="card">
      <div class="muted">è¼¸å…¥æš±ç¨±å¾Œé–‹å§‹ï¼ˆå»ºè­°ï¼šç­ç´š-åº§è™Ÿï¼Œä¾‹å¦‚ 204-15ï¼‰</div>
      <div style="margin-top:10px" class="row">
        <div style="flex:1;min-width:240px">
          <input id="name" placeholder="ä½ çš„æš±ç¨± / ç­ç´šåº§è™Ÿ" maxlength="18">
        </div>
        <button class="primary" id="btnGo">é–‹å§‹é—–é—œ</button>
      </div>

      <div class="grid2" style="margin-top:12px">
        <div class="stat">
          <div class="muted">ä¸‰é—œåœ°åœ–</div>
          <div class="map" style="margin-top:10px">
            <span class="node">ç¬¬1é—œï¼šè‡ªä»¥ç‚ºå¹½é»˜</span>
            <span class="node">ç¬¬2é—œï¼šè¬›è©±å¤ªç›´</span>
            <span class="node">ç¬¬3é—œï¼šä¿®å¾©é«˜æ‰‹</span>
          </div>
          <div class="mini" style="margin-top:10px">
            æ¯é—œ 4 é¡Œï¼Œå…± 12 é¡Œã€‚ç­”å°åŠ åˆ†ï¼‹é€£æ“Šï¼›ç­”éŒ¯æ‰£â¤ï¸ã€‚<br>
            çµæŸæœƒå‡ºå¾½ç« ï¼Œå¯æˆªåœ–äº¤ä½œæ¥­ã€‚
          </div>
        </div>
        <div class="stat">
          <div class="muted">å°æé†’</div>
          <div class="mini" style="margin-top:10px">
            é€™å€‹éŠæˆ²æ˜¯åœ¨ç·´ã€Œåˆ¤æ–·ç•Œç·šã€èˆ‡ã€Œä¿®å¾©èªªæ³•ã€ï¼Œä¸æ˜¯åœ¨é¼“å‹µå˜´äººã€‚<br>
            å£è¨£ï¼š<b>æ„åœ–æ˜¯ä½ çš„ï¼›æ„Ÿå—æ˜¯å°æ–¹çš„ã€‚</b>
          </div>
        </div>
      </div>
    </div>

    <!-- Game -->
    <div id="screenGame" class="card hide">
      <div class="space">
        <div class="row">
          <span class="pill">ç©å®¶ï¼š<b id="player">â€”</b></span>
          <span class="pill">åˆ†æ•¸ï¼š<b id="score">0</b></span>
          <span class="pill">é€£æ“Šï¼š<b id="streak">0</b>ğŸ”¥</span>
          <span class="pill">â¤ï¸ï¼š<b id="life">3</b></span>
        </div>
        <div class="row">
          <span class="pill">é—œå¡ï¼š<b id="stageName">â€”</b></span>
          <span class="pill">é¡Œç›®ï¼š<b id="idx">0</b>/<b id="total">0</b></span>
          <span class="pill">å‰©é¤˜ï¼š<b id="t">6</b>s</span>
        </div>
      </div>

      <div class="map" style="margin-top:10px">
        <span id="n0" class="node">ç¬¬1é—œï¼šè‡ªä»¥ç‚ºå¹½é»˜</span>
        <span id="n1" class="node">ç¬¬2é—œï¼šè¬›è©±å¤ªç›´</span>
        <span id="n2" class="node">ç¬¬3é—œï¼šä¿®å¾©é«˜æ‰‹</span>
      </div>

      <div style="margin-top:10px" class="bar"><div id="fill" class="fill"></div></div>

      <div id="qBox" class="pop">
        <div class="muted" style="margin-top:10px">é€™å¥è©±æ˜¯ ğŸŸ¢ğŸŸ¡ğŸ”´ï¼Ÿï¼ˆå…ˆç›´è¦ºé¸ï¼Œå†çœ‹è§£æï¼‰</div>
        <div class="bigQ" id="q">â€”</div>

        <div class="row" style="margin-top:10px">
          <button class="g" id="btnG">ğŸŸ¢ ç¶ ç‡ˆ</button>
          <button class="y" id="btnY">ğŸŸ¡ é»ƒç‡ˆ</button>
          <button class="r" id="btnR">ğŸ”´ ç´…ç‡ˆ</button>
          <button id="btnHint">ğŸ’¡ 5ç§’æª¢æŸ¥</button>
        </div>

        <div id="hint" class="mini hide" style="margin-top:10px">
          â‘ ç¬‘çš„æ˜¯äº‹é‚„æ˜¯ç¬‘äººï¼Ÿâ‘¡å…¬é–‹è¬›æœƒä¸æœƒè®“äººé›£å ªï¼Ÿâ‘¢è¢«æˆªåœ–æ•¢ä¸æ•¢ï¼Ÿâ‘£å°æ–¹èƒ½ä¸èƒ½èªªã€Œä¸ã€ï¼Ÿ
        </div>
      </div>

      <div id="result" class="hide" style="margin-top:12px">
        <div class="row" style="align-items:flex-start">
          <div style="flex:1;min-width:260px" class="stat">
            <div class="row">
              <span id="tag" class="tag">â€”</span>
              <span class="muted">å»ºè­°ï¼š</span><b id="ansTxt">â€”</b>
              <span class="pill" id="gainPill">+0</span>
            </div>
            <div style="margin-top:8px;font-weight:1000" id="why">â€”</div>
            <div class="mini" style="margin-top:10px">å¤±æ‰‹ä¿®å¾©å¥ï¼š<b>ã€Œæˆ‘å‰›å‰›é‚£å¥ä¸å¤ªå¥½ï¼Œæˆ‘æ”¶å›ï¼Œå°ä¸èµ·ã€‚ã€</b></div>
          </div>

          <div style="flex:1;min-width:260px" class="stat">
            <div class="muted">åŠ åˆ†é—œï¼šæŠŠå®ƒæ”¹æˆã€ŒåŒæ¨£æœ‰æ•ˆä½†ä¸å‚·äººã€ï¼ˆå¯è·³éï¼‰</div>
            <textarea id="rewrite" placeholder="è¼¸å…¥ä½ çš„æ”¹å¯«ï¼ˆä¾‹å¦‚ï¼šå…ˆå¾è©¢â†’èªªå½±éŸ¿â†’çµ¦é¸æ“‡ / åŠ ä¸Šæ”¶å›èˆ‡é“æ­‰ï¼‰"></textarea>
            <div class="row" style="margin-top:8px">
              <button class="primary" id="btnSubmitRewrite">æäº¤æ”¹å¯« +2ï¼ˆå«é“æ­‰å†+1ï¼‰</button>
              <button id="btnNext">ä¸‹ä¸€é¡Œ</button>
            </div>
            <div class="mini" style="margin-top:8px">
              å°æŠ€å·§ï¼šæŠŠã€Œä½ æ€æ¨£æ€æ¨£ã€â†’ã€Œæˆ‘éœ€è¦â€¦ä½ å¯ä»¥â€¦å—ï¼Ÿã€<br>
              æˆ–å…ˆå•ã€Œæˆ‘å¯ä»¥ç›´æ¥èªªå—ï¼Ÿã€å†è¬›äº‹å¯¦ã€‚
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- End -->
    <div id="screenEnd" class="card hide">
      <div class="space">
        <h1>ğŸ çµç®—æˆç¸¾</h1>
        <button id="btnAgain" class="primary">å†ç©ä¸€æ¬¡</button>
      </div>

      <div class="grid2">
        <div class="stat">
          <div class="muted">ç©å®¶</div><b id="endName">â€”</b>
          <div class="muted" style="margin-top:10px">ç¸½åˆ†</div><b id="endScore">0</b>
          <div class="muted" style="margin-top:10px">æ­£ç¢ºç‡</div><b id="endAcc">0%</b>
          <div class="muted" style="margin-top:10px">æœ€é«˜é€£æ“Š</div><b id="endStreak">0</b>
          <div class="muted" style="margin-top:10px">æ”¹å¯«æ¬¡æ•¸</div><b id="endRewrite">0</b>
        </div>
        <div class="stat">
          <div class="muted">ä½ æ‹¿åˆ°çš„å¾½ç« </div>
          <div id="badges" class="row" style="margin-top:10px"></div>
          <div class="mini" style="margin-top:10px">
            å»ºè­°ï¼šæˆªåœ–é€™é äº¤çµ¦è€å¸«ï¼ˆæˆ–æŠŠåˆ†æ•¸å¿µçµ¦è€å¸«ç™»è¨˜ï¼‰ã€‚
          </div>
          <div class="mini" style="margin-top:8px">
            ç­ç´šå…±è­˜å¥ï¼ˆå¯èƒŒï¼‰ï¼š<b>ã€Œèª å¯¦è¦æœ‰ç•Œç·šï¼šå…ˆé¡§æ„Ÿå—ï¼Œå†è¬›äº‹å¯¦ã€‚ã€</b>
          </div>
        </div>
      </div>
    </div>

  </div>

<script>
  // ===== é¡Œåº«ï¼ˆå«ä¸‰å¤§ä¸»é¡Œï¼‰=====
  // suggested: "G" | "Y" | "R"
  const BANK = [
    // ç¬¬1é—œï¼šè‡ªä»¥ç‚ºå¹½é»˜
    {topic:"humor", text:"ã€Œä½ ä»Šå¤©çœ‹èµ·ä¾†èƒ–äº†æ¬¸å“ˆå“ˆã€", suggested:"R", why:"æ‹¿å¤–è²Œ/èº«æç•¶ç¬‘é»ï¼é«˜æ•æ„Ÿï¼Œå®¹æ˜“ç¾è¾±èˆ‡è‡ªå‘ã€‚"},
    {topic:"humor", text:"ã€Œç¬‘æ­»ä½ æ€éº¼é‚£éº¼ç¬¨ã€", suggested:"R", why:"è²¼æ¨™ç±¤è²¶ä½äººï¼ŒåŒ…æˆç©ç¬‘ä¹Ÿä¸€æ¨£æœƒå‚·äººã€‚"},
    {topic:"humor", text:"ã€Œä½ é€™é«®å‹å¾ˆå‹‡æ•¢æ¬¸ã€", suggested:"Y", why:"å¯èƒ½åœ¨åæ§½å¤–è¡¨ï¼›é—œä¿‚å¾ˆç†Ÿä¹Ÿè¨±å¯ï¼Œä½†å…¬é–‹è¬›å¾ˆå®¹æ˜“è¸©ç·šã€‚"},
    {topic:"humor", text:"ã€Œä½ å¾ˆç»ç’ƒå¿ƒæ¬¸ï¼Œæˆ‘é–‹ç©ç¬‘çš„ã€", suggested:"R", why:"æŠŠè²¬ä»»æ¨å›å°æ–¹ï¼äºŒæ¬¡å‚·å®³ï¼›ã€æˆ‘é–‹ç©ç¬‘ã€ä¸æ˜¯å…è²¬é‡‘ç‰Œã€‚"},
    {topic:"humor", text:"ã€Œä½ æ²’æœ‹å‹å–”ï¼Ÿéƒ½è‡ªå·±ä¸€å€‹ã€", suggested:"R", why:"æ‹¿ç¤¾äº¤è™•å¢ƒé–‹ç©ç¬‘æœƒåˆºåˆ°ç—›é»ï¼Œå®¹æ˜“é€ æˆå­¤ç«‹ã€‚"},
    {topic:"humor", text:"ã€Œæˆ‘å‰›å‰›ç·Šå¼µåˆ°è¬›éŒ¯ï¼Œç¬‘æˆ‘å•¦ã€", suggested:"G", why:"ç¬‘é»æ”¾åœ¨è‡ªå·±èº«ä¸Šï¼ˆè‡ªå˜²ï¼‰é€šå¸¸è¼ƒå®‰å…¨ã€‚"},
    {topic:"humor", text:"ã€Œä½ çš®è†šä»Šå¤©å¾ˆç†±é¬§ã€", suggested:"R", why:"å¤–è²Œ/çš®è†šç‹€æ³æ˜¯é«˜æ•æ„Ÿé»ï¼Œå®¹æ˜“ç¾æ¥ã€‚"},
    {topic:"humor", text:"ã€Œæˆ‘æ€•ä½ æœƒä¸èˆ’æœï¼Œæˆ‘å…ˆç¢ºèªä¸€ä¸‹å¯ä»¥å—ï¼Ÿã€", suggested:"G", why:"å…ˆé¡§åˆ°å°æ–¹æ„Ÿå—ã€é¡˜æ„åœä¸‹ä¾†ç¢ºèªï¼Œæ˜¯å°Šé‡å‹å¹½é»˜ã€‚"},
    {topic:"humor", text:"ã€Œä½ å®¶å¾ˆæœ‰éŒ¢å–”ï¼Ÿè«‹å®¢å•¦å“ˆå“ˆã€", suggested:"Y", why:"å®¶åº­/é‡‘éŒ¢æ˜¯æ•æ„Ÿé»ï¼Œå®¹æ˜“è¢«èµ·é¬¨æˆ–è²¼æ¨™ç±¤ã€‚"},
    {topic:"humor", text:"ã€Œä½ é€™åˆ†æ•¸â€¦æˆ‘ä¸æ„å¤–å•¦ã€", suggested:"R", why:"å…¬é–‹å˜²è«·æˆç¸¾ï¼è®“äººé›£å ªï¼Œå±¬æ–¼ç¾è¾±å‹ç©ç¬‘ã€‚"},
    {topic:"humor", text:"ã€Œä½ ä»Šå¤©ç©¿é€™æ¨£ä¹Ÿæ•¢å‡ºé–€å–”ï¼Ÿã€", suggested:"R", why:"å˜²è«·ç©¿è‘—ï¼å…¬é–‹è²¶ä½ï¼Œå°æ–¹æœƒè¢«è¿«å°·å°¬æˆ–å‡ç¬‘ã€‚"},
    {topic:"humor", text:"ã€Œä½ æ˜¯ä¸æ˜¯åˆåœ¨æ¼”ã€", suggested:"R", why:"å¦å®šæƒ…ç·’/æ±‚åŠ©ï¼Œæœƒè®“äººæ›´ä¸æ•¢èªªã€‚"},
    // ç¬¬2é—œï¼šè¬›è©±å¤ªç›´
    {topic:"blunt", text:"ã€Œæˆ‘åªæ˜¯å¯¦è©±å¯¦èªªï¼šä½ çœŸçš„å¾ˆèƒ–ã€", suggested:"R", why:"ã€å¯¦è©±ã€ä¸ç­‰æ–¼å¯ä»¥å‚·äººï¼›è€Œä¸”å¤–è²Œä¸å¿…è©•è«–ã€‚"},
    {topic:"blunt", text:"ã€Œä½ å¾ˆåµæ¬¸ã€", suggested:"Y", why:"å¯èƒ½æ˜¯åœ¨è¬›éœ€æ±‚ï¼Œä½†åƒæŒ‡è²¬ï¼›å¯æ”¹ã€æˆ‘æƒ³å°ˆå¿ƒï¼Œä½ èƒ½å°è²ä¸€é»å—ï¼Ÿã€"},
    {topic:"blunt", text:"ã€Œä½ å¾ˆç…©æ¬¸ä¸è¦å†å•äº†ã€", suggested:"R", why:"å¸¶æƒ…ç·’æ”»æ“Šï¼›å¯ä»¥æ‹’çµ•ä½†è¦å°Šé‡ã€‚"},
    {topic:"blunt", text:"ã€Œä½ é€™æ¨£åšå¾ˆæ²’æ•ˆç‡ã€", suggested:"Y", why:"åœ¨è¬›äº‹æƒ…ä½†èªæ°£åƒè©•åˆ¤ï¼›å¯æ”¹ã€è¦ä¸è¦è©¦è©¦å¦ä¸€ç¨®æ–¹æ³•ï¼Ÿã€"},
    {topic:"blunt", text:"ã€Œä½ å°±æ˜¯ç»ç’ƒå¿ƒã€", suggested:"R", why:"æŠŠè²¬ä»»æ¨å›å°æ–¹ï¼äºŒæ¬¡å‚·å®³ï¼›æ‡‰åœä¸‹ä¾†ç¢ºèªç•Œç·šã€‚"},
    {topic:"blunt", text:"ã€Œæˆ‘å¯ä»¥ç›´æ¥èªªå—ï¼Ÿæˆ‘è¦ºå¾—ä½ å‰›å‰›é‚£å¥å¯èƒ½æœƒè®“äººä¸èˆ’æœã€", suggested:"G", why:"å…ˆå¾è©¢åŒæ„ï¼‹æŒ‡å‡ºå½±éŸ¿ï¼Œä¸è²¼æ¨™ç±¤ï¼Œæ˜¯æœ‰ç•Œç·šçš„ç›´ã€‚"},
    {topic:"blunt", text:"ã€Œä½ é€™æ¨£å¾ˆä¸Ÿè‡‰æ¬¸ã€", suggested:"R", why:"ç¾è¾±å‹èªå¥ï¼Œæœƒé€ æˆå‚·å®³èˆ‡å°ç«‹ã€‚"},
    {topic:"blunt", text:"ã€Œä½ åŠŸèª²å°±æ˜¯ä¸å¤ åŠªåŠ›ã€", suggested:"R", why:"è²¼æ¨™ç±¤ã€å¿½ç•¥åŸå› ï¼›æ‡‰æ”¹æˆå…·é«”å”åŠ©èˆ‡ä¸‹ä¸€æ­¥ã€‚"},
    {topic:"blunt", text:"ã€Œæˆ‘ä¸æ˜¯é‡å°ä½ ï¼Œæˆ‘æ˜¯é‡å°äº‹ï¼šå‰›å‰›é‚£æ®µæˆ‘è½ä¸æ¸…æ¥šï¼Œå¯ä»¥å†è¬›ä¸€æ¬¡å—ï¼Ÿã€", suggested:"G", why:"èšç„¦äº‹æƒ…ï¼‹å…·é«”è«‹æ±‚ï¼Œé™ä½æ”»æ“Šæ„Ÿã€‚"},
    {topic:"blunt", text:"ã€Œä½ çœŸçš„å¾ˆä¸æœƒè®€æ›¸ã€", suggested:"R", why:"äººèº«è©•åƒ¹ã€æ‰“æ“Šè‡ªå°Šï¼›æ‡‰æ”¹æˆå…·é«”å›é¥‹èˆ‡æ–¹æ³•ã€‚"},
    {topic:"blunt", text:"ã€Œæˆ‘æœ‰é»æ“”å¿ƒä½ æœ€è¿‘çœ‹èµ·ä¾†å¾ˆç´¯ï¼Œä½ é‚„å¥½å—ï¼Ÿã€", suggested:"G", why:"é—œå¿ƒå¼ç›´è©±ï¼šå…ˆé¡§æ„Ÿå—ï¼Œå†å•ç‹€æ³ã€‚"},
    {topic:"blunt", text:"ã€Œä½ é€™é«®å‹è¶…é†œã€", suggested:"R", why:"å¤–è²Œç¾è¾±ï¼›å°±ç®—æ˜¯ã€ç›´ã€ä¹Ÿæ²’å¿…è¦ã€‚"},
    // ç¬¬3é—œï¼šä¿®å¾©é«˜æ‰‹ï¼ˆç·´åœä¸‹ä¾†/é“æ­‰/ä¿®å¾©ï¼‰
    {topic:"repair", text:"ã€Œæˆ‘å‰›å‰›é‚£å¥ä¸å¤ªå¥½ï¼Œæˆ‘æ”¶å›ï¼Œå°ä¸èµ·ã€‚ã€", suggested:"G", why:"æ‰¿èªå½±éŸ¿ï¼‹åœæ­¢ï¼‹é“æ­‰ï¼ä¿®å¾©æœ€æœ‰æ•ˆã€‚"},
    {topic:"repair", text:"ã€Œä½ ä¸è¦æƒ³å¤ªå¤šå•¦ï¼Œæˆ‘åˆä¸æ˜¯æ•…æ„çš„ã€‚ã€", suggested:"R", why:"æ¨è²¬ï¼‹å¦å®šæ„Ÿå—ï¼æœƒæ›´ç”Ÿæ°£ã€‚"},
    {topic:"repair", text:"ã€Œæˆ‘å‰›å‰›è¬›å¤ªå¿«äº†ï¼Œæˆ‘é‡è¬›ä¸€æ¬¡ã€‚ä½ å¸Œæœ›æˆ‘ç”¨ä»€éº¼æ–¹å¼èªªï¼Ÿã€", suggested:"G", why:"çµ¦å°æ–¹é¸æ“‡æ„Ÿï¼Œèƒ½é™è¡çªã€‚"},
    {topic:"repair", text:"ã€Œå¥½å•¦ç®—äº†ï¼Œä½ å°±æ˜¯ç»ç’ƒå¿ƒã€‚ã€", suggested:"R", why:"äºŒæ¬¡å‚·å®³ï¼Œç›´æ¥çˆ†ç‚¸ã€‚"},
    {topic:"repair", text:"ã€Œæˆ‘æƒ³ç¢ºèªä¸€ä¸‹ï¼šä½ å‰›å‰›æ˜¯ä¸æ˜¯ä¸èˆ’æœï¼Ÿå¦‚æœæ˜¯ï¼Œæˆ‘å…ˆåœã€‚ã€", suggested:"G", why:"å…ˆç¢ºèªï¼‹å…ˆåœï¼Œæ˜¯æˆç†Ÿåšæ³•ã€‚"},
    {topic:"repair", text:"ã€Œæˆ‘åªæ˜¯é–‹ç©ç¬‘è€Œå·²ï¼Œä½ å¹¹å˜›é‚£éº¼èªçœŸã€‚ã€", suggested:"R", why:"æŠŠè²¬ä»»æ¨çµ¦å°æ–¹ï¼è¸©ç·šã€‚"},
    {topic:"repair", text:"ã€Œæˆ‘ç†è§£ä½ æœƒä¸èˆ’æœï¼Œæˆ‘æœƒæ³¨æ„ï¼Œä¸‹æ¬¡ä¸æ‹¿é€™å€‹é»é–‹ç©ç¬‘ã€‚ã€", suggested:"G", why:"åŒç†ï¼‹æ‰¿è«¾æ”¹è®Šï¼Œä¿®å¾©æ•ˆæœé«˜ã€‚"},
    {topic:"repair", text:"ã€Œä¸ç„¶ä½ ä¹Ÿè¬›æˆ‘å•Šï¼Œæ‰¯å¹³ã€‚ã€", suggested:"R", why:"æŠŠé—œä¿‚æ‹‰é€²äº’å‚·ï¼Œæœƒæ›´ç³Ÿã€‚"},
    {topic:"repair", text:"ã€Œæˆ‘èªªé‚£å¥çš„æ™‚å€™æ²’é¡§åˆ°ä½ æ„Ÿå—ï¼Œè¬è¬ä½ æé†’æˆ‘ã€‚ã€", suggested:"G", why:"æ‰¿èªï¼‹æ„Ÿè¬æé†’ï¼Œæœ‰åŠ©å’Œè§£ã€‚"},
    {topic:"repair", text:"ã€Œä½ è‡ªå·±å…ˆèª¿æ•´æƒ…ç·’å†èªªã€‚ã€", suggested:"R", why:"å¦å®šå°æ–¹æ„Ÿå—ï¼Œå®¹æ˜“å‡æº«ã€‚"},
  ];

  // ===== é—œå¡è¨­å®š =====
  const STAGES = [
    { key:"humor",  name:"ç¬¬1é—œï¼šè‡ªä»¥ç‚ºå¹½é»˜", count:4 },
    { key:"blunt",  name:"ç¬¬2é—œï¼šè¬›è©±å¤ªç›´", count:4 },
    { key:"repair", name:"ç¬¬3é—œï¼šä¿®å¾©é«˜æ‰‹",   count:4 },
  ];

  const TIME_LIMIT = 6;   // æ¯é¡Œç§’æ•¸
  const MAX_LIFE  = 3;    // ç”Ÿå‘½å€¼

  const $ = id => document.getElementById(id);
  const screens = { start:$("screenStart"), game:$("screenGame"), end:$("screenEnd") };

  function tagInfo(s){
    if(s==="G") return {cls:"tG", txt:"ğŸŸ¢ ç¶ ç‡ˆ", full:"å®‰å…¨"};
    if(s==="Y") return {cls:"tY", txt:"ğŸŸ¡ é»ƒç‡ˆ", full:"æœ‰é¢¨éšª"};
    return {cls:"tR", txt:"ğŸ”´ ç´…ç‡ˆ", full:"è¸©ç·š"};
  }

  function shuffle(arr){
    const a = [...arr];
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  // ===== ç‹€æ…‹ =====
  let player="", score=0, streak=0, bestStreak=0, correct=0, rewrites=0;
  let life=MAX_LIFE;
  let stageStats = {}; // {key:{total,correct}}
  let pool=[], idx=0, timer=null, t=TIME_LIMIT, locked=false;

  function buildPool(){
    stageStats = {};
    const out = [];
    for(const st of STAGES){
      const items = BANK.filter(x=>x.topic===st.key);
      const pick = shuffle(items).slice(0, st.count);
      stageStats[st.key] = { total: pick.length, correct: 0 };
      out.push(...pick.map(q=>({...q, stageKey: st.key})));
    }
    return out;
  }

  function beep(ok=true){
    try{
      const ctx = new (window.AudioContext||window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type="sine";
      o.frequency.value = ok ? 660 : 220;
      g.gain.value = 0.08;
      o.connect(g); g.connect(ctx.destination);
      o.start();
      setTimeout(()=>{o.stop(); ctx.close();}, 120);
    }catch(e){}
  }

  function show(screen){
    Object.values(screens).forEach(s=>s.classList.add("hide"));
    screens[screen].classList.remove("hide");
  }

  function start(){
    player = ($("name").value || "").trim();
    if(!player){ $("name").focus(); return; }

    score=0; streak=0; bestStreak=0; correct=0; rewrites=0;
    life=MAX_LIFE;
    pool = buildPool();
    idx = 0;

    $("player").textContent = player;
    $("score").textContent = score;
    $("streak").textContent = streak;
    $("life").textContent = life;
    $("total").textContent = pool.length;

    updateMap();
    show("game");
    nextQ();
  }

  function stopTimer(){
    if(timer){ clearInterval(timer); timer=null; }
  }

  function updateBar(){
    const p = (t / TIME_LIMIT) * 100;
    $("fill").style.width = `${Math.max(0,p)}%`;
  }

  function stageNameOf(q){
    return STAGES.find(s=>s.key===q.stageKey)?.name || "â€”";
  }

  function updateMap(){
    const q = pool[idx] || pool[Math.max(0, idx-1)];
    const currentKey = q?.stageKey;

    STAGES.forEach((st, i)=>{
      const node = $("n"+i);
      node.classList.remove("on","done");
      const stat = stageStats[st.key];
      const done = stat && stat.correct === stat.total && stat.total>0; // å®Œç¾æ‰ç®— done
      if(done) node.classList.add("done");
      if(st.key===currentKey) node.classList.add("on");
    });
  }

  function resetQUI(){
    $("hint").classList.add("hide");
    $("result").classList.add("hide");
    $("rewrite").value = "";
    locked=false;
    $("qBox").classList.remove("shake");
    $("qBox").classList.add("pop");
    setTimeout(()=>$("qBox").classList.remove("pop"), 200);
  }

  function nextQ(){
    if(life<=0){ end(true); return; }
    if(idx >= pool.length){ end(false); return; }

    resetQUI();

    const q = pool[idx];
    $("idx").textContent = idx+1;
    $("q").textContent = q.text;
    $("stageName").textContent = stageNameOf(q);

    updateMap();
    startTimer();
  }

  function startTimer(){
    stopTimer();
    t = TIME_LIMIT;
    $("t").textContent = t;
    updateBar();

    timer = setInterval(()=>{
      t--;
      $("t").textContent = t;
      updateBar();
      if(t<=0){
        stopTimer();
        answer(null); // timeout
      }
    }, 1000);
  }

  function loseLife(){
    life--;
    $("life").textContent = life;
  }

  function answer(choice){
    if(locked) return;
    locked=true;
    stopTimer();

    const q = pool[idx];
    const sug = q.suggested;

    let gained = 0;
    let ok = false;

    if(choice===null){
      beep(false);
      streak = 0;
      loseLife();
      $("qBox").classList.add("shake");
    }else if(choice===sug){
      ok = true;
      beep(true);

      correct++;
      stageStats[q.stageKey].correct++;

      streak++;
      bestStreak = Math.max(bestStreak, streak);

      const speedBonus = Math.max(0, t);         // 0~5
      const streakBonus = Math.min(10, streak);  // 1~10
      gained = 10 + speedBonus*2 + streakBonus;  // åŸºç¤10 + é€Ÿåº¦ + é€£æ“Š
      score += gained;
    }else{
      beep(false);
      streak = 0;
      loseLife();
      $("qBox").classList.add("shake");
    }

    $("score").textContent = score;
    $("streak").textContent = streak;

    const tag = tagInfo(sug);
    $("tag").className = `tag ${tag.cls}`;
    $("tag").textContent = tag.txt;
    $("ansTxt").textContent = tag.full;
    $("why").textContent = q.why;
    $("gainPill").textContent = ok ? `+${gained}` : "0";

    $("result").classList.remove("hide");

    // è‹¥å‰›å¥½æ‰£åˆ° 0 â¤ï¸ï¼Œè®“ä»–çœ‹å®Œè§£æå¾Œä¸‹ä¸€é¡Œæœƒç›´æ¥çµç®—
  }

  function submitRewrite(){
    const txt = ($("rewrite").value || "").trim();
    if(!txt) return;

    rewrites++;
    let add = 2;

    // æœ‰ä¿®å¾©é—œéµå­—å†+1ï¼ˆæ›´åƒéŠæˆ²ï¼‰
    const repairWords = ["å°ä¸èµ·","æŠ±æ­‰","æ”¶å›","æˆ‘éŒ¯äº†","æˆ‘æœƒæ³¨æ„","å…ˆåœ","è¬è¬ä½ æé†’"];
    if(repairWords.some(w=>txt.includes(w))) add += 1;

    score += add;
    $("score").textContent = score;
    beep(true);

    // å°æç¤ºï¼šä¸è¦é‡è¤‡åˆ·ï¼ˆå¯æ¥å—ï¼Œä½†é€™è£¡å°±ä¸é™åˆ¶ï¼‰
  }

  function end(isGameOver){
    show("end");

    $("endName").textContent = player;
    $("endScore").textContent = score;
    $("endRewrite").textContent = rewrites;

    const acc = Math.round((correct / pool.length) * 100);
    $("endAcc").textContent = `${acc}%`;
    $("endStreak").textContent = bestStreak;

    const badges = [];
    // åŸºç¤å¾½ç« 
    if(isGameOver) badges.push("ğŸ’¥ è¢«â¤ï¸æ‰“å€’äº†ï¼ˆå†æŒ‘æˆ°ä¸€æ¬¡ï¼‰");
    if(acc >= 85) badges.push("ğŸ§  ç•Œç·šé›·é”é«˜æ‰‹");
    if(bestStreak >= 4) badges.push("ğŸ”¥ é€£æ“Šé«˜æ‰‹");
    if(rewrites >= 3) badges.push("âœï¸ æ”¹å¯«ç·´ç¿’å®¶");
    if(rewrites >= 5) badges.push("ğŸ› ï¸ ä¿®å¾©é”äºº");

    // ä¸»é¡Œå¾½ç« 
    const bluntAcc = stageStats.blunt ? Math.round((stageStats.blunt.correct/stageStats.blunt.total)*100) : 0;
    const repairAcc = stageStats.repair ? Math.round((stageStats.repair.correct/stageStats.repair.total)*100) : 0;
    if(bluntAcc >= 75) badges.push("ğŸ¯ ç›´è©±è½‰æ›å¸«");
    if(repairAcc >= 75) badges.push("ğŸ•Šï¸ å’Œå¹³ä¿®å¾©å¸«");

    // å®Œç¾é€šé—œï¼šä¸‰é—œéƒ½å…¨å°
    const perfectAll = STAGES.every(st => stageStats[st.key] && stageStats[st.key].correct === stageStats[st.key].total);
    if(perfectAll) badges.push("ğŸ† å®Œç¾é€šé—œç‹");

    if(badges.length===0) badges.push("ğŸ™‚ å‹å–„æ–°æ‰‹ï¼ˆå†ç©ä¸€æ¬¡æœƒæ›´å¼·ï¼‰");

    const box = $("badges");
    box.innerHTML = "";
    badges.forEach(b=>{
      const span = document.createElement("span");
      span.className = "badge";
      span.textContent = b;
      box.appendChild(span);
    });
  }

  function again(){
    $("name").value = player;
    show("start");
  }

  // ===== äº‹ä»¶ =====
  $("btnGo").onclick = start;
  $("btnG").onclick = ()=>answer("G");
  $("btnY").onclick = ()=>answer("Y");
  $("btnR").onclick = ()=>answer("R");
  $("btnNext").onclick = ()=>{ idx++; nextQ(); };
  $("btnHint").onclick = ()=>$("hint").classList.toggle("hide");
  $("btnSubmitRewrite").onclick = submitRewrite;
  $("btnAgain").onclick = again;

  // éµç›¤ï¼ˆè‹¥æœ‰äººç”¨ç­†é›»ï¼‰
  document.addEventListener("keydown",(e)=>{
    if(screens.game.classList.contains("hide")) return;
    if(e.key==="1") answer("G");
    if(e.key==="2") answer("Y");
    if(e.key==="3") answer("R");
  });
</script>
</body>
</html>
