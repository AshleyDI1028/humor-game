<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ¢—ç•Œç·šå¤§é—–é—œï¼ˆå€‹äººç‰ˆï¼‰</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --line:#243059;
      --text:#eef3ff; --muted:#b9c4e6;
      --g:#22c55e; --y:#facc15; --r:#ef4444; --b:#2a5bff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Arial,"Noto Sans TC",sans-serif;background:radial-gradient(1200px 800px at 20% -10%, #1a2b6a 0%, var(--bg) 55%);color:var(--text);}
    .wrap{max-width:980px;margin:0 auto;padding:18px;}
    .card{background:rgba(18,26,51,.92);border:1px solid var(--line);border-radius:18px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);}
    h1{margin:0;font-size:22px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .space{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    input, textarea{
      width:100%;border:1px solid var(--line);background:#0f1734;color:var(--text);
      border-radius:14px;padding:12px;font-size:15px;outline:none;
    }
    textarea{min-height:70px;resize:vertical}
    button{
      border:1px solid var(--line);background:#0f1734;color:var(--text);
      padding:12px 14px;border-radius:14px;cursor:pointer;font-weight:900;
      transition:transform .06s ease, filter .15s ease;
    }
    button:active{transform:scale(.98)}
    button:hover{filter:brightness(1.08)}
    .primary{background:var(--b);border-color:var(--b)}
    .g{border-color:rgba(34,197,94,.5)} .y{border-color:rgba(250,204,21,.5)} .r{border-color:rgba(239,68,68,.5)}
    .g:hover{background:rgba(34,197,94,.14)} .y:hover{background:rgba(250,204,21,.14)} .r:hover{background:rgba(239,68,68,.14)}
    .bigQ{font-size:34px;line-height:1.22;font-weight:1000;margin:10px 0 6px}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);padding:8px 10px;border-radius:999px;color:var(--muted);font-size:13px}
    .bar{height:10px;background:#0e1531;border:1px solid var(--line);border-radius:999px;overflow:hidden}
    .fill{height:100%;width:0%;background:linear-gradient(90deg,var(--g),var(--y),var(--r))}
    .grid2{display:grid;grid-template-columns:1.2fr .8fr;gap:12px;margin-top:12px}
    @media (max-width:900px){.grid2{grid-template-columns:1fr}}
    .tag{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:1000;border:1px solid transparent}
    .tG{background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.35)}
    .tY{background:rgba(250,204,21,.18);border-color:rgba(250,204,21,.35)}
    .tR{background:rgba(239,68,68,.18);border-color:rgba(239,68,68,.35)}
    .shake{animation:shake .25s ease-in-out 0s 2}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}
    .pop{animation:pop .18s ease-out}
    @keyframes pop{0%{transform:scale(.98)}100%{transform:scale(1)}}
    .mini{font-size:12px;line-height:1.5;color:var(--muted)}
    .hide{display:none}
    .stat{border:1px solid var(--line);border-radius:16px;padding:12px;background:#0f1734}
    .stat b{font-size:18px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="space" style="margin-bottom:12px">
      <h1>ğŸ® æ¢—ç•Œç·šå¤§é—–é—œï¼ˆå€‹äººç‰ˆï¼‰</h1>
      <div class="pill">ğŸŸ¢å®‰å…¨ï½œğŸŸ¡æœ‰é¢¨éšªï½œğŸ”´è¸©ç·šã€€â±ï¸æ¯é¡Œ 5 ç§’</div>
    </div>

    <!-- Start Screen -->
    <div id="screenStart" class="card">
      <div class="muted">è¼¸å…¥æš±ç¨±å¾Œé–‹å§‹ï¼ˆå»ºè­°ï¼šç­ç´šåº§è™Ÿï¼Œä¾‹å¦‚ 204-15ï¼‰</div>
      <div style="margin-top:10px" class="row">
        <div style="flex:1;min-width:240px">
          <input id="name" placeholder="ä½ çš„æš±ç¨± / ç­ç´šåº§è™Ÿ" maxlength="18">
        </div>
        <button class="primary" id="btnGo">é–‹å§‹é—–é—œ</button>
      </div>
      <div class="mini" style="margin-top:10px">
        éŠæˆ²çµæŸæœƒé¡¯ç¤ºæˆç¸¾é ï¼Œå¯æˆªåœ–äº¤çµ¦è€å¸«ã€‚<br>
        å°æé†’ï¼šé€™æ˜¯ã€Œç·´åˆ¤æ–·èˆ‡ä¿®å¾©ã€ï¼Œä¸æ˜¯åœ¨é¼“å‹µå˜´äººã€‚
      </div>
    </div>

    <!-- Game Screen -->
    <div id="screenGame" class="card hide">
      <div class="space">
        <div class="row">
          <span class="pill">ç©å®¶ï¼š<b id="player">â€”</b></span>
          <span class="pill">åˆ†æ•¸ï¼š<b id="score">0</b></span>
          <span class="pill">é€£æ“Šï¼š<b id="streak">0</b>ğŸ”¥</span>
        </div>
        <div class="row">
          <span class="pill">é¡Œç›®ï¼š<b id="idx">0</b>/<b id="total">0</b></span>
          <span class="pill">å‰©é¤˜ï¼š<b id="t">5</b>s</span>
        </div>
      </div>

      <div style="margin-top:10px" class="bar"><div id="fill" class="fill"></div></div>

      <div id="qBox" class="pop">
        <div class="muted" style="margin-top:10px">é€™å¥è©±æ˜¯ ğŸŸ¢ğŸŸ¡ğŸ”´ï¼Ÿï¼ˆ3 ç§’å…§ç›´è¦ºé¸ï¼Œå‰©ä¸‹æ™‚é–“å¯æ€è€ƒï¼‰</div>
        <div class="bigQ" id="q">â€”</div>

        <div class="row" style="margin-top:10px">
          <button class="g" id="btnG">ğŸŸ¢ ç¶ ç‡ˆ</button>
          <button class="y" id="btnY">ğŸŸ¡ é»ƒç‡ˆ</button>
          <button class="r" id="btnR">ğŸ”´ ç´…ç‡ˆ</button>
          <button id="btnHint">ğŸ’¡ 5ç§’æª¢æŸ¥</button>
        </div>

        <div id="hint" class="mini hide" style="margin-top:10px">
          â‘ ç¬‘çš„æ˜¯äº‹é‚„æ˜¯ç¬‘äººï¼Ÿâ‘¡å…¬é–‹è¬›æœƒä¸æœƒè®“äººé›£å ªï¼Ÿâ‘¢è¢«æˆªåœ–çµ¦å°å¸«/å®¶é•·çœ‹æ•¢ä¸æ•¢ï¼Ÿâ‘£å°æ–¹èƒ½æ‹’çµ•ä¸ç¬‘å—ï¼Ÿ
        </div>
      </div>

      <div id="result" class="hide" style="margin-top:12px">
        <div class="row" style="align-items:flex-start">
          <div style="flex:1;min-width:260px" class="stat">
            <div class="row">
              <span id="tag" class="tag">â€”</span>
              <span class="muted">å»ºè­°ï¼š</span><b id="ansTxt">â€”</b>
            </div>
            <div style="margin-top:8px;font-weight:900" id="why">â€”</div>
            <div class="mini" style="margin-top:10px">æç¤ºï¼šæ„åœ–æ˜¯ä½ çš„ï¼›æ„Ÿå—æ˜¯å°æ–¹çš„ã€‚å°æ–¹ä¸èˆ’æœï¼ç«‹åˆ»åœã€‚</div>
          </div>

          <div style="flex:1;min-width:260px" class="stat">
            <div class="muted">åŠ åˆ†é—œï¼šæŠŠå®ƒæ”¹æˆã€ŒåŒæ¨£å¥½ç©ä½†ä¸å‚·äººã€ï¼ˆå¯è·³éï¼‰</div>
            <textarea id="rewrite" placeholder="æ”¹å¯«ä¸€å¥æ›´å¥½çš„èªªæ³•ï¼ˆä¾‹å¦‚ï¼šæ”¹ç¬‘äº‹ä¸ç¬‘äººï¼æˆ–åŠ ä¸Šå°Šé‡èˆ‡ä¿®å¾©ï¼‰"></textarea>
            <div class="row" style="margin-top:8px">
              <button class="primary" id="btnSubmitRewrite">æäº¤æ”¹å¯« +2</button>
              <button id="btnNext">ä¸‹ä¸€é¡Œ</button>
            </div>
            <div class="mini" style="margin-top:8px">
              åƒè€ƒï¼šæŠŠã€Œä½ æ€éº¼é‚£éº¼â€¦ã€â†’ã€Œæˆ‘å‰›å‰›æœ‰é»è¢«åš‡åˆ°/æˆ‘æƒ³ç¢ºèªä¸€ä¸‹â€¦ã€ï¼›å¤±æ‰‹å°±èªªã€Œæˆ‘æ”¶å›ï¼Œå°ä¸èµ·ã€ã€‚
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- End Screen -->
    <div id="screenEnd" class="card hide">
      <div class="space">
        <h1>ğŸ çµç®—æˆç¸¾</h1>
        <button id="btnAgain" class="primary">å†ç©ä¸€æ¬¡</button>
      </div>

      <div class="grid2">
        <div class="stat">
          <div class="muted">ç©å®¶</div><b id="endName">â€”</b>
          <div class="muted" style="margin-top:10px">ç¸½åˆ†</div><b id="endScore">0</b>
          <div class="muted" style="margin-top:10px">æ­£ç¢ºç‡</div><b id="endAcc">0%</b>
          <div class="muted" style="margin-top:10px">æœ€é«˜é€£æ“Š</div><b id="endStreak">0</b>
        </div>
        <div class="stat">
          <div class="muted">ç¨±è™Ÿ</div>
          <div style="font-size:20px;font-weight:1000;margin-top:6px" id="title">â€”</div>
          <div class="mini" style="margin-top:10px">
            å»ºè­°åšæ³•ï¼šæˆªåœ–é€™é äº¤çµ¦è€å¸«ï¼ˆæˆ–æŠŠåˆ†æ•¸å¿µçµ¦è€å¸«ç™»è¨˜ï¼‰ã€‚
          </div>
        </div>
      </div>
    </div>

  </div>

<script>
  // é¡Œåº«ï¼šä½ å¯è‡ªç”±åŠ é¡Œï¼ˆtext/ suggested/ whyï¼‰
  const Q = [
    {text:"ã€Œä½ ä»Šå¤©çœ‹èµ·ä¾†èƒ–äº†æ¬¸å“ˆå“ˆã€", suggested:"R", why:"æ‹¿å¤–è²Œ/èº«æç•¶ç¬‘é»ï¼é«˜æ•æ„Ÿï¼Œå®¹æ˜“è®“äººç¾è¾±èˆ‡è‡ªå‘ã€‚"},
    {text:"ã€Œç¬‘æ­»ä½ æ€éº¼é‚£éº¼ç¬¨ã€", suggested:"R", why:"è²¼æ¨™ç±¤è²¶ä½äººï¼ŒåŒ…æˆç©ç¬‘ä¹Ÿä¸€æ¨£æœƒå‚·äººã€‚"},
    {text:"ã€Œä½ é€™é«®å‹å¾ˆå‹‡æ•¢æ¬¸ã€", suggested:"Y", why:"å¯èƒ½æ˜¯åæ§½å¤–è¡¨ï¼›è‹¥å…¬é–‹è¬›å¾ˆå®¹æ˜“è¸©ç·šã€‚"},
    {text:"ã€Œä½ æ˜¯ä¸æ˜¯åˆåœ¨æ¼”ã€", suggested:"R", why:"å¦å®šæƒ…ç·’/æ±‚åŠ©ï¼Œæœƒè®“äººæ›´ä¸æ•¢èªªã€‚"},
    {text:"ã€Œä½ å¾ˆç»ç’ƒå¿ƒæ¬¸ï¼Œæˆ‘é–‹ç©ç¬‘çš„ã€", suggested:"R", why:"æŠŠè²¬ä»»æ¨å›å°æ–¹ï¼äºŒæ¬¡å‚·å®³ï¼›ã€æˆ‘é–‹ç©ç¬‘ã€ä¸æ˜¯å…è²¬é‡‘ç‰Œã€‚"},
    {text:"ã€Œä½ å®¶å¾ˆæœ‰éŒ¢å–”ï¼Ÿè«‹å®¢å•¦å“ˆå“ˆã€", suggested:"Y", why:"å®¶åº­/é‡‘éŒ¢æ˜¯æ•æ„Ÿé»ï¼Œå®¹æ˜“è¢«èµ·é¬¨æˆ–è²¼æ¨™ç±¤ã€‚"},
    {text:"ã€Œä½ æ²’æœ‹å‹å–”ï¼Ÿéƒ½è‡ªå·±ä¸€å€‹ã€", suggested:"R", why:"æ‹¿ç¤¾äº¤è™•å¢ƒé–‹ç©ç¬‘æœƒåˆºåˆ°ç—›é»ï¼Œå®¹æ˜“é€ æˆå­¤ç«‹ã€‚"},
    {text:"ã€Œä½ é€™åˆ†æ•¸â€¦æˆ‘ä¸æ„å¤–å•¦ã€", suggested:"R", why:"å…¬é–‹å˜²è«·æˆç¸¾ï¼è®“äººé›£å ªï¼Œå±¬æ–¼ç¾è¾±å‹ç©ç¬‘ã€‚"},
    {text:"ã€Œæˆ‘å‰›å‰›ç·Šå¼µåˆ°è¬›éŒ¯ï¼Œç¬‘æˆ‘å•¦ã€", suggested:"G", why:"ç¬‘é»æ”¾åœ¨è‡ªå·±èº«ä¸Šï¼ˆè‡ªå˜²ï¼‰é€šå¸¸è¼ƒå®‰å…¨ã€‚"},
    {text:"ã€Œä½ ä¸èˆ’æœæˆ‘å°±ä¸è¬›äº†ï¼Œè¬è¬ä½ æé†’æˆ‘ã€", suggested:"G", why:"èƒ½åœä¸‹ä¾†å°Šé‡ç•Œç·šï¼Œæ˜¯æˆç†Ÿå¹½é»˜ã€‚"},
    {text:"ã€Œä½ çš®è†šä»Šå¤©å¾ˆç†±é¬§ã€", suggested:"R", why:"å¤–è²Œ/çš®è†šç‹€æ³æ˜¯é«˜æ•æ„Ÿé»ï¼Œå®¹æ˜“ç¾æ¥ã€‚"},
    {text:"ã€Œä½ ä»Šå¤©ç©¿é€™æ¨£ä¹Ÿæ•¢å‡ºé–€å–”ï¼Ÿã€", suggested:"R", why:"å˜²è«·ç©¿è‘—ï¼å…¬é–‹è²¶ä½ï¼Œå°æ–¹æœƒè¢«è¿«å°·å°¬æˆ–å‡ç¬‘ã€‚"},
  ];

  // éŠæˆ²è¨­å®š
  const TOTAL = 10;        // æ¯å±€é¡Œæ•¸ï¼ˆ<= Q.lengthï¼‰
  const TIME_LIMIT = 5;    // æ¯é¡Œç§’æ•¸

  const $ = id => document.getElementById(id);
  const screens = {
    start: $("screenStart"),
    game: $("screenGame"),
    end: $("screenEnd")
  };

  function tagInfo(s){
    if(s==="G") return {cls:"tG", txt:"ğŸŸ¢ ç¶ ç‡ˆ", full:"å®‰å…¨"};
    if(s==="Y") return {cls:"tY", txt:"ğŸŸ¡ é»ƒç‡ˆ", full:"æœ‰é¢¨éšª"};
    return {cls:"tR", txt:"ğŸ”´ ç´…ç‡ˆ", full:"è¸©ç·š"};
  }

  let player="", score=0, streak=0, bestStreak=0, correct=0;
  let pool=[], idx=0, timer=null, t=TIME_LIMIT, locked=false;

  function pickQuestions(){
    // shuffle
    const arr = [...Q];
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr.slice(0, Math.min(TOTAL, arr.length));
  }

  function beep(ok=true){
    // ç°¡å–®éŸ³æ•ˆï¼ˆä¸éœ€è¦å¤–éƒ¨æª”æ¡ˆï¼‰
    try{
      const ctx = new (window.AudioContext||window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type="sine";
      o.frequency.value = ok ? 660 : 220;
      g.gain.value = 0.08;
      o.connect(g); g.connect(ctx.destination);
      o.start();
      setTimeout(()=>{o.stop(); ctx.close();}, 120);
    }catch(e){}
  }

  function show(screen){
    Object.values(screens).forEach(s=>s.classList.add("hide"));
    screens[screen].classList.remove("hide");
  }

  function start(){
    player = ($("name").value || "").trim();
    if(!player){ $("name").focus(); return; }
    score=0; streak=0; bestStreak=0; correct=0;
    pool = pickQuestions();
    idx = 0;
    $("player").textContent = player;
    $("score").textContent = score;
    $("streak").textContent = streak;
    $("total").textContent = pool.length;
    show("game");
    nextQ();
  }

  function resetQUI(){
    $("hint").classList.add("hide");
    $("result").classList.add("hide");
    $("rewrite").value = "";
    locked=false;
    $("qBox").classList.remove("shake");
    $("qBox").classList.add("pop");
    setTimeout(()=>$("qBox").classList.remove("pop"), 200);
  }

  function nextQ(){
    if(idx >= pool.length){ end(); return; }
    resetQUI();
    $("idx").textContent = idx+1;
    $("q").textContent = pool[idx].text;
    startTimer();
  }

  function startTimer(){
    stopTimer();
    t = TIME_LIMIT;
    $("t").textContent = t;
    updateBar();
    timer = setInterval(()=>{
      t--;
      $("t").textContent = t;
      updateBar();
      if(t<=0){
        stopTimer();
        // æ²’ä½œç­”è¦–ç‚ºéŒ¯ï¼Œç›´æ¥æ­ç¤º
        answer(null);
      }
    }, 1000);
  }

  function stopTimer(){
    if(timer){ clearInterval(timer); timer=null; }
  }

  function updateBar(){
    const p = (t / TIME_LIMIT) * 100;
    $("fill").style.width = `${Math.max(0,p)}%`;
  }

  function answer(choice){
    if(locked) return;
    locked=true;
    stopTimer();

    const q = pool[idx];
    const sug = q.suggested;
    const isCorrect = (choice === sug);
    const speedBonus = Math.max(0, t); // è¶Šå¿«è¶Šå¤šï¼ˆ0~4ï¼‰
    let gained = 0;

    if(choice===null){
      // time out
      beep(false);
      streak = 0;
      $("qBox").classList.add("shake");
    }else if(isCorrect){
      beep(true);
      correct++;
      streak++;
      bestStreak = Math.max(bestStreak, streak);
      gained = 5 + speedBonus; // åŸºç¤ 5 åˆ† + é€Ÿåº¦
      score += gained;
    }else{
      beep(false);
      streak = 0;
      $("qBox").classList.add("shake");
    }

    $("score").textContent = score;
    $("streak").textContent = streak;

    // reveal
    const tag = tagInfo(sug);
    $("tag").className = `tag ${tag.cls}`;
    $("tag").textContent = `${tag.txt}`;
    $("ansTxt").textContent = `${tag.full}`;
    $("why").textContent = q.why;

    $("result").classList.remove("hide");
  }

  function submitRewrite(){
    // æœ‰å¯«å°±åŠ åˆ†ï¼ˆå€‹äººç‰ˆä¸åšèªæ„è©•åˆ†ï¼Œé¿å…çˆ­è­°ï¼‰
    const txt = ($("rewrite").value || "").trim();
    if(!txt) return;
    score += 2;
    $("score").textContent = score;
    beep(true);
  }

  function end(){
    show("end");
    $("endName").textContent = player;
    $("endScore").textContent = score;
    const acc = Math.round((correct / pool.length) * 100);
    $("endAcc").textContent = `${acc}%`;
    $("endStreak").textContent = bestStreak;

    let title = "ğŸ™‚ å‹å–„æ–°æ‰‹";
    if(acc>=80 && bestStreak>=3) title = "ğŸ§  ç•Œç·šé›·é”é«˜æ‰‹";
    if(acc>=90 && bestStreak>=4) title = "ğŸ† å¹½é»˜å®ˆé–€å“¡ï¼ˆæœ€å¼·ï¼‰";
    if(acc<50) title = "ğŸ›‘ å°å¿ƒè¸©ç·šç‹ï¼ˆéœ€è¦ç·´ä¿®å¾©ï¼‰";
    $("title").textContent = title;
  }

  function again(){
    $("name").value = player;
    show("start");
  }

  // events
  $("btnGo").onclick = start;
  $("btnG").onclick = ()=>answer("G");
  $("btnY").onclick = ()=>answer("Y");
  $("btnR").onclick = ()=>answer("R");
  $("btnNext").onclick = ()=>{ idx++; nextQ(); };
  $("btnHint").onclick = ()=>$("hint").classList.toggle("hide");
  $("btnSubmitRewrite").onclick = submitRewrite;
  $("btnAgain").onclick = again;

  // ä¹Ÿæ”¯æ´éµç›¤ï¼ˆè‹¥ç”¨ç­†é›»ï¼‰
  document.addEventListener("keydown",(e)=>{
    if(screens.game.classList.contains("hide")) return;
    if(e.key==="1") answer("G");
    if(e.key==="2") answer("Y");
    if(e.key==="3") answer("R");
  });
</script>
</body>
</html>
